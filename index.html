<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Peta Johor Populasi</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <style>
        #map {
            height: 90vh;
            width: 100%;
        }
        .info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 6px;
            border-radius: 4px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            z-index: 1000; /* Ensure it's above the map */
        }
        .facility-list {
            margin-top: 5px;
            font-size: 0.9em;
        }
        .facility-list ul {
            list-style-type: disc;
            margin-left: 20px;
            padding: 0;
        }
        .facility-list li {
            margin-bottom: 2px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="info" id="infoBox">Hover atas daerah untuk info</div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        var popData = {
          "BATU PAHAT":503400,
          "JOHOR BAHRU":1758500,
          "KLUANG":328000,
          "KOTA TINGGI":228900,
          "KULAI":339600,
          "MERSING":80000,
          "MUAR":318500,
          "PONTIAN":175500,
          "SEGAMAT":201500,
          "TANGKAK":166900
        };

        // --- NEW: FACILITIES DATA ---
        var facilitiesData = {
            "BATU PAHAT": [
                "Batu Pahat Hospital",
                "AEON Big Batu Pahat",
                "Universiti Tun Hussein Onn Malaysia"
            ],
            "JOHOR BAHRU": [
                "Sultanah Aminah Hospital",
                "City Square Johor Bahru",
                "Legoland Malaysia",
                "Johor Premium Outlets"
            ],
            "KLUANG": [
                "Kluang Mall",
                "Mount Lambak",
                "Kluang Railway Coffee"
            ],
            "KOTA TINGGI": [
                "Kota Tinggi Waterfall",
                "Muzium Kota Tinggi"
            ],
            "KULAI": [
                "IOI Mall Kulai",
                "Palm Resort Golf & Country Club"
            ],
            "MERSING": [
                "Mersing Jetty (to Tioman Island)",
                "Pulau Sibu"
            ],
            "MUAR": [
                "Muar River Cruise",
                "Tanjung Emas Park",
                "Jalan Maharani Food Street"
            ],
            "PONTIAN": [
                "Tanjung Piai National Park",
                "Pulau Kukup"
            ],
            "SEGAMAT": [
                "Segamat Bus Terminal",
                "Kolej Komuniti Segamat"
            ],
            "TANGKAK": [
                "Gunung Ledang (Mount Ophir)",
                "Tangkak Textile Town"
            ]
            // Add more parliamentary areas and their facilities here
        };
        // --- END NEW: FACILITIES DATA ---


        var map = L.map('map').setView([2.5, 103], 8);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Custom control for info box
        var info = L.control();

        info.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;
        };

        // Corrected and enhanced info.update function
        info.update = function (props) {
            let content = 'Hover atas daerah untuk info';
            if (props && props.Parliament) {
                const parliamentName = props.Parliament;
                const population = popData[parliamentName] ? popData[parliamentName].toLocaleString() : 'N/A';
                const facilities = facilitiesData[parliamentName];

                content = `<b>${parliamentName}</b><br>Pop: ${population}`;

                if (facilities && facilities.length > 0) {
                    let facilitiesHtml = '<div class="facility-list"><b>Facilities:</b><ul>';
                    facilities.forEach(facility => {
                        facilitiesHtml += `<li>${facility}</li>`;
                    });
                    facilitiesHtml += '</ul></div>';
                    content += facilitiesHtml;
                } else {
                    content += '<div class="facility-list">No facilities listed.</div>';
                }
            }
            this._div.innerHTML = content;
        };

        info.addTo(map);

        // --- START OF GEOJSON INTEGRATION ---
        // IMPORTANT: Replace this placeholder with your actual GeoJSON data.
        // It should be a valid GeoJSON FeatureCollection or Feature object.
        var malaysiaGeoJson = {
            "type": "FeatureCollection",
            "features": [
                // Your actual GeoJSON features go here.
                // Each feature should have a 'properties' object, and ideally
                // a 'Parliament' property that matches keys in your popData and facilitiesData.
                /* Example:
                {
                    "type": "Feature",
                    "properties": {
                        "Parliament": "BATU PAHAT"
                    },
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [
                            // Your coordinates for BATU PAHAT
                        ]
                    }
                },
                */
            ]
        };

        // Function to style GeoJSON features
        function style(feature) {
            return {
                fillColor: 'lightgray', // Default fill color
                weight: 2,
                opacity: 1,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.7
            };
        }

        // Function to highlight feature on mouseover
        function highlightFeature(e) {
            var layer = e.target;

            layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
            });

            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                layer.bringToFront();
            }

            info.update(layer.feature.properties);
        }

        // Function to reset highlight on mouseout
        var geojson; // Declare geojson variable in a broader scope

        function resetHighlight(e) {
            geojson.resetStyle(e.target);
            info.update();
        }

        // Function to zoom to feature on click (optional)
        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds());
        }

        // Function to bind events to each feature
        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature // Optional: click to zoom
            });

            // Add a popup with Parliament name, population, and facilities
            if (feature.properties && feature.properties.Parliament) {
                var parliamentName = feature.properties.Parliament;
                var population = popData[parliamentName] ? popData[parliamentName].toLocaleString() : 'N/A';
                var facilities = facilitiesData[parliamentName];
                let popupContent = `<b>${parliamentName}</b><br>Pop: ${population}`;

                if (facilities && facilities.length > 0) {
                    popupContent += '<br><b>Facilities:</b><ul>';
                    facilities.forEach(facility => {
                        popupContent += `<li>${facility}</li>`;
                    });
                    popupContent += '</ul>';
                } else {
                    popupContent += '<br>No facilities listed.';
                }
                layer.bindPopup(popupContent);
            }
        }

        // Add GeoJSON layer to map
        // Ensure malaysiaGeoJson is not empty before adding
        if (malaysiaGeoJson && malaysiaGeoJson.features && malaysiaGeoJson.features.length > 0) {
            geojson = L.geoJSON(malaysiaGeoJson, {
                style: style,
                onEachFeature: onEachFeature
            }).addTo(map);
        } else {
            console.warn("No GeoJSON data found or GeoJSON is empty. Please replace 'malaysiaGeoJson' with your actual data.");
        }
        // --- END OF GEOJSON INTEGRATION ---

    </script>
</body>
</html>
